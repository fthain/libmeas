This code implements the kernel level driver for connecting rpi3
GPIO header to the data lines in the GPIB bus. Thus no expensive GPIB
adapters are needed. I merely took the original code and modified it to 
work with newer linux kernels. As noted in the original README below,
this is not suitable for high speed data trasnfers.

The original code is in gpib_bitbang.c.orig and the new code in gpib_bitbang.c

This code still uses the legacy integer GPIO interface, which has been
removed from linux kernel 4.14. I need to convert the code to the new 
interface. The last kernel that supports the legacy interface is 4.13.

Jussi Eloranta (jmeloranta@gmail.com)

Here is the original README file:

To all interested GPIB people:

A few months ago Thomas Klima posted the
gpib_bitbang driver for the Raspberry Pi.

In my opinion, a very interesting project.
Probably, the cheapest and simplest way to
access the GPIB bus without a commercial
adapter, requiring only a Raspberry-Pi and
a gpib connector. Maybe not suitable for
high speed data transfer, but effective
for medium speed work.

A limitation I did find was from the use
of polling for handshake, a hindrance with
a single core cpu. Here is a new version of
the code, freely derived from the original
one.

In this version, data transfer is performed
partially using the interrupt system. I mean,
in the original code all handhake was by
polling, but waiting for the first byte of
a transaction may last up to several hundreds
milliseconds. Here first byte is handled through
interrupt, subsequent data stream by polling.

I tried also a full interrupt handshake, but
probably the game is not worth the candle
because interrupt handling overhead wastes
more CPU than polling bytes after the first
one.

Other changes:

Functionality for WaitSRQ() and ibwait()
has been added.

Debug can be switched on/off on the fly,
no need to recompile.

etc. (e.g., the .h file swallowed by the
.c file for simplicity).


To compile the code with linux-gpib-4.0.3:

Create the directory:
"linux-gpib-4.0.3/drivers/gpib/gpib_bitbang"

Add into the directory a file "gpib_bitbang.c"
containing the code in the attached file and
a "Makefile" containing the single line:
obj-m += gpib_bitbang.o

Add at end of file
"linux-gpib-4.0.3/drivers/gpib/Makefile"
the line:
obj-y += gpib_bitbang/

Go on as ususal:
./configure
make
sudo make install
sudo modprobe gpib_bitbang
gpib_config -m 0 -t gpib_bitbang

Have a good code

Marcello Carla'


-- 
Marcello Carla'  -  carla@...
University of Florence - Dept. of Physics
Via G. Sansone 1 - I 50019 Sesto F. (Firenze) Italy
Tel.: 39 055 457 2055/2013/2060
